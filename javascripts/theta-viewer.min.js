!function($){"use strict";var THETA_VIEWER={};THETA_VIEWER.createRenderer=function(element){this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setSize(element.width(),element.height()),this.renderer.setClearColor(0,1),$(element).append(this.renderer.domElement)},THETA_VIEWER.createScene=function(){this.scene=new THREE.Scene},THETA_VIEWER.createLight=function(){var ambient=new THREE.AmbientLight(16777215);this.scene.add(ambient)},THETA_VIEWER.createCamera=function(element){var fov=72,aspect=element.width()/element.height(),near=.1,far=1e3;this.camera=new THREE.PerspectiveCamera(fov,aspect,near,far),this.camera.lookAt({x:1,y:0,z:0}),this.scene.add(this.camera)},THETA_VIEWER.createSphereWithTexture=function(texture){function createGeometry(texture){var thetaStart,thetaLength,radius=1,widthSegments=32,heightSegments=16,phiStart=0,phiLength=2*Math.PI;return thetaLength=2*Math.PI*texture.image.height/texture.image.width,thetaLength>Math.PI&&(thetaLength=Math.PI),thetaStart=(Math.PI-thetaLength)/2,new THREE.SphereGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength)}var material,geometry,mesh;material=new THREE.MeshBasicMaterial({overdraw:!0,map:texture,side:THREE.BackSide}),geometry=createGeometry(texture),mesh=new THREE.Mesh(geometry,material),THETA_VIEWER.scene.add(mesh)},THETA_VIEWER.addEventListeners=function(element){function onResize(){THETA_VIEWER.camera.aspect=element.width()/element.height(),THETA_VIEWER.camera.updateProjectionMatrix(),THETA_VIEWER.renderer.setSize(element.width(),element.height())}function onMouseDown(event){event.preventDefault(),isRotating=!0,onMouseDownLat=lat,onMouseDownLng=lng,onMouseDownX=event.clientX,onMouseDownY=event.clientY}function onMouseMove(event){var phi,theta;isRotating===!0&&(lat=.1*(event.clientY-onMouseDownY)+onMouseDownLat,lat=Math.max(-85,Math.min(85,lat)),lng=.1*(onMouseDownX-event.clientX)+onMouseDownLng,phi=(90-lat)*Math.PI/180,theta=lng*Math.PI/180,THETA_VIEWER.camera.lookAt({x:Math.sin(phi)*Math.cos(theta),y:Math.cos(phi),z:Math.sin(phi)*Math.sin(theta)}))}function onMouseUp(){isRotating=!1}function onMouseWheel(event){var fov=THETA_VIEWER.camera.fov,fovMin=20,fovMax=150;event.wheelDeltaY?fov-=.05*event.wheelDeltaY:event.wheelDelta?fov-=.05*event.wheelDelta:event.detail&&(fov+=event.detail),fovMin>fov&&(fov=fovMin),fov>fovMax&&(fov=fovMax),THETA_VIEWER.camera.fov=fov,THETA_VIEWER.camera.updateProjectionMatrix()}var isRotating=!1,onMouseDownLat=0,onMouseDownLng=0,onMouseDownX=0,onMouseDownY=0,lat=0,lng=0;$(element).on("mousedown",onMouseDown).on("mousemove",onMouseMove).on("mouseup",onMouseUp).on("mouseout",onMouseUp).on("resize",onResize),$(element).get(0).addEventListener("mousewheel",onMouseWheel,!1),$(element).get(0).addEventListener("DOMMouseScroll",onMouseWheel,!1)},THETA_VIEWER.render=function(){requestAnimationFrame(THETA_VIEWER.render),THETA_VIEWER.renderer.render(THETA_VIEWER.scene,THETA_VIEWER.camera)},THETA_VIEWER.initWithTexture=function(that,texture){THETA_VIEWER.createRenderer(that),THETA_VIEWER.createScene(),THETA_VIEWER.createCamera(that),THETA_VIEWER.createSphereWithTexture(texture),THETA_VIEWER.addEventListeners(that),THETA_VIEWER.render()},$.fn.createThetaViewerWithTexture=function(texture){return THETA_VIEWER.initWithTexture(this,texture),this},$.fn.createThetaViewer=function(image_url){var texture,mapping,that=this,success=function(){THETA_VIEWER.initWithTexture(that,texture)},error=function(){console.log("loading error: "+image_url)};return mapping=void 0,texture=THREE.ImageUtils.loadTexture(image_url,mapping,success,error),this}}(jQuery);